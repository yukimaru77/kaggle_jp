# è¦ç´„ 
ã“ã®ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã¯ã€Kaggleã®ã‚³ãƒ³ãƒšãƒ†ã‚£ã‚·ãƒ§ãƒ³å‚åŠ è€…ãŒã€Mistral 7Bãƒ¢ãƒ‡ãƒ«ã¨Llama 3 8Bãƒ¢ãƒ‡ãƒ«ã‚’æ¯”è¼ƒã—ãŸéš›ã«é­é‡ã—ãŸOOMã‚¨ãƒ©ãƒ¼ã«é–¢ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

Cody_Nullã¯ã€8ãƒ“ãƒƒãƒˆã«é‡å­åŒ–ã•ã‚ŒãŸMistral 7Bãƒ¢ãƒ‡ãƒ«ã§ã¯OOMã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã«ã€åŒã˜ã8ãƒ“ãƒƒãƒˆã«é‡å­åŒ–ã•ã‚ŒãŸLlama 3 8Bãƒ¢ãƒ‡ãƒ«ã§ã¯ç™ºç”Ÿã—ãªã„ã“ã¨ã«ç–‘å•ã‚’æŠ±ãã¾ã—ãŸã€‚å½¼ã¯ã€ãƒ¢ãƒ‡ãƒ«ã®ã‚µã‚¤ã‚ºã‚„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é•ã„ãŒåŽŸå› ã§ã¯ãªã„ã‹ã¨æŽ¨æ¸¬ã—ã¾ã—ãŸã€‚

Valentin Wernerã¯ã€ãƒ¢ãƒ‡ãƒ«ã®ã‚µã‚¤ã‚ºã‚„éš ã‚Œå±¤ã®ã‚µã‚¤ã‚ºãŒåŽŸå› ã§ã¯ãªã„ã“ã¨ã‚’æŒ‡æ‘˜ã—ã€Kaggleã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãŒåŽŸå› ã§ã‚ã‚‹å¯èƒ½æ€§ã‚’æŒ‡æ‘˜ã—ã¾ã—ãŸã€‚å½¼ã¯ã€æ–°ã—ã„ç’°å¢ƒã§ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã‚’æŽ¨å¥¨ã—ã¾ã—ãŸã€‚

Cody_Nullã¯ã€è‡ªåˆ†ãŒé–“é•ã£ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã«æŠ•ç¨¿ã—ã¦ã„ãŸã“ã¨ã«æ°—ã¥ãã€å•é¡Œã®åŽŸå› ãŒBitsAndBytesã®è¨­å®šã«ã‚ã‚‹ã“ã¨ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚å½¼ã¯ã€ã‚³ãƒ¼ãƒ‰ã®æœ€åˆã®éƒ¨åˆ†ã§ã¯OOMã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€å¾Œã®éƒ¨åˆ†ã§ã¯æ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’æ˜Žã‚‰ã‹ã«ã—ã¾ã—ãŸã€‚

Valentin Wernerã¯ã€Cody_Nullã®ãƒŸã‚¹ã‚’é¢ç™½ãŒã‚Šã¤ã¤ã‚‚ã€å½¼ã®æŠ•ç¨¿ãŒå½¹ã«ç«‹ã£ãŸã“ã¨ã‚’èªã‚ã¾ã—ãŸã€‚

ã“ã®ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã¯ã€ã‚³ãƒ³ãƒšãƒ†ã‚£ã‚·ãƒ§ãƒ³å‚åŠ è€…ãŒé­é‡ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹æŠ€è¡“çš„ãªå•é¡Œã‚’å…±æœ‰ã—ã€è§£æ±ºç­–ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®å ´ã¨ã—ã¦å½¹ç«‹ã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€å‚åŠ è€…åŒå£«ã®äº¤æµã‚’ä¿ƒé€²ã—ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®çµæŸã‚’å¼·ã‚ã‚‹å½¹å‰²ã‚‚æžœãŸã—ã¦ã„ã¾ã™ã€‚


---
# 7B ãƒ¢ãƒ‡ãƒ«ã§OOMã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã«ã€8B ãƒ¢ãƒ‡ãƒ«ã¯æ­£å¸¸ã«å‹•ä½œã™ã‚‹ã®ã¯ãªãœï¼Ÿ

**Cody_Null** *2024å¹´6æœˆ26æ—¥ æ°´æ›œæ—¥ 05:48:42 GMT+0900 (æ—¥æœ¬æ¨™æº–æ™‚)* (7ç¥¨)

ç•°ãªã‚‹ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚’æ¯”è¼ƒã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€8ãƒ“ãƒƒãƒˆã«é‡å­åŒ–ã•ã‚ŒãŸMistral 7Bãƒ¢ãƒ‡ãƒ«ã¨ã€åŒã˜ã8ãƒ“ãƒƒãƒˆã«é‡å­åŒ–ã•ã‚ŒãŸLlama 3 8Bãƒ¢ãƒ‡ãƒ«ã‚’æ¯”è¼ƒã—ã¾ã™ã€‚7Bãƒ¢ãƒ‡ãƒ«ï¼ˆã¨ä»–ã®ãƒ¢ãƒ‡ãƒ«ï¼‰ã§ã¯OOMã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ãŒã€Llama 3 8Bã§ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã®ãƒ¢ãƒ‡ãƒ«ã¯ç•°ãªã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æŒã¡ã€ãƒ¡ãƒ¢ãƒªè¦ä»¶ã‚‚ç•°ãªã‚‹ã“ã¨ã¯ç†è§£ã—ã¦ã„ã¾ã™ã—ã€ã‚µã‚¤ã‚ºãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ã«å®Œå…¨ã«ä¾å­˜ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã“ã¨ã‚‚ç†è§£ã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€å¿µã®ãŸã‚ã€ä»–ã«ã“ã®ç¾è±¡ã‚’å¥‡å¦™ã«æ„Ÿã˜ã‚‹äººã¯ã„ã¾ã›ã‚“ã‹ï¼Ÿ

---
# ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ

> ## Valentin Werner
> 
> ã‚µã‚¤ã‚ºãŒåŽŸå› ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Mistral 7b 8ãƒ“ãƒƒãƒˆã¯6.87 GBã€Llama 3 8B 8ãƒ“ãƒƒãƒˆã¯7.05 GBã§ã™ï¼ˆå‚ç…§: [https://huggingface.co/spaces/hf-accelerate/model-memory-usage](https://huggingface.co/spaces/hf-accelerate/model-memory-usage)ï¼‰ã€‚ç§ã®çŸ¥ã‚‹é™ã‚Šã€ä¸¡ãƒ¢ãƒ‡ãƒ«ã¯éš ã‚Œå±¤ã®ã‚µã‚¤ã‚ºã¨æ¬¡å…ƒã‚‚åŒä¸€ãªã®ã§ã€Mistralã®åŸ‹ã‚è¾¼ã¿ãŒLlamaã‚ˆã‚Šã‚‚å¤šãã®RAMã‚’æ¶ˆè²»ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
> 
> ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã‹ï¼Ÿã“ã‚Œã¯Kaggleã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãŒåŽŸå› ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å…¬å¹³ãªæ¯”è¼ƒã‚’è¡Œã†ã«ã¯ã€å¸¸ã«æ–°ã—ãå†èµ·å‹•ã—ãŸç’°å¢ƒã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆç§ã®çµŒé¨“ã§ã¯ã€torch.cuda.empty_cacheã¯åŒã˜åŠ¹æžœã‚’ã‚‚ãŸã‚‰ã—ã¾ã›ã‚“ï¼‰ã€‚
> 
> 
> 
> > ## Cody_Nullãƒˆãƒ”ãƒƒã‚¯ä½œæˆè€…
> > 
> > ç‹‚ã£ã¦ãªãã¦ã‚ˆã‹ã£ãŸã€‚ä»Šæ—¥æ”¹ã‚ã¦ç¢ºèªã—ã¦ã€è‡ªåˆ†ãŒã©ã“ã‹ã§æ„šã‹ãªãƒŸã‚¹ã‚’ã—ã¦ã„ãªã„ã‹ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚ä½•ã‹ç™ºè¦‹ã—ãŸã‚‰ã€ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’æ›´æ–°ã—ã¾ã™ã€‚
> > 
> > 
> > 
---
> ## Cody_Nullãƒˆãƒ”ãƒƒã‚¯ä½œæˆè€…
> 
> ä»Šæ°—ã¥ãã¾ã—ãŸãŒã€å®Œå…¨ã«é–“é•ã£ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã«æŠ•ç¨¿ã—ã¦ã„ã¾ã—ãŸã€‚
> 
> æ›´æ–°: åŽŸå› ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã®ä¸Šéƒ¨ãŒOOMã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã—ã€ä¸‹éƒ¨ãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã™ã€‚
> 
> `
> 
> BitsAndBytesã®è¨­å®š
> 
> bnb_config =  BitsAndBytesConfig(
> 
>     load_in_8bit=True,
> 
>     bnb_8bit_compute_dtype=torch.float16,
> 
>     bnb_8bit_use_double_quant=False)
> 
> bnb_config = BitsAndBytesConfig(
> 
>     load_in_8bit=True,
> 
>     bnb_8bit_quant_type="nf8",
> 
>     bnb_8bit_use_double_quant=True,
> 
>     bnb_8bit_compute_dtype=torch.bfloat16)
> 
> `
> 
> 
> 
> > ## Valentin Werner
> > 
> > ã‚ã‹ã‚Šã¾ã—ãŸç¬‘
> > 
> > ã§ã‚‚ã€ã‚‚ã†4ã¤ã®ã„ã„ã­ã‚’ã‚‚ã‚‰ã£ã¡ã‚ƒã„ã¾ã—ãŸã­ðŸ˜‰
> > 
> > 
> > 
> > > ## Cody_Nullãƒˆãƒ”ãƒƒã‚¯ä½œæˆè€…
> > > 
> > > å½¹ã«ç«‹ã¦ã°ã„ã„ã‚“ã§ã™ã‘ã©ã­ç¬‘ã€‚ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚‚ã¡ã‚ƒã‚“ã¨å®Œæˆã•ã›ã‚ˆã†ã¨æ€ã£ã¦ã€‚
> > > 
> > > 
> > > 
---

