# è¦ç´„ 
ã“ã®ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã¯ã€Kaggleã®LMSYS - Chatbot Arena Human Preference Predictionsã‚³ãƒ³ãƒšãƒ†ã‚£ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ã€gemma-2-27Bãƒ¢ãƒ‡ãƒ«ã‚’vLLMã§åˆ©ç”¨ã§ãã‚‹ã‹ã©ã†ã‹ã«ã¤ã„ã¦è­°è«–ã—ã¦ã„ã¾ã™ã€‚

**è¦ç´„:**

* ãƒ¦ãƒ¼ã‚¶ãƒ¼yechenzhi1ã¯ã€gemma-2-27Bã‚’vLLMã§åˆ©ç”¨ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€FlashInferã®GPUã‚µãƒãƒ¼ãƒˆã®åˆ¶é™ã«ã‚ˆã‚Šã€T4 GPUã§ã¯å®Ÿè¡Œã§ããªã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
* Yixiao Yuanã¯ã€gemma-2ã‚’Hugging Faceã§å®Ÿè¡Œã§ãã‚‹ã“ã¨ã‚’ææ¡ˆã—ã€vLLMã¯ç”Ÿæˆã‚¿ã‚¹ã‚¯ã«é©ã—ã¦ã„ã¾ã™ãŒã€åˆ†é¡žã‚¿ã‚¹ã‚¯ã§ã¯Hugging Faceã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãŒä¼¼ã¦ã„ã‚‹ã¨è¿°ã¹ã¦ã„ã¾ã™ã€‚
* yechenzhi1ã¯ã€é‡å­åŒ–ã•ã‚ŒãŸgemma-2-27Bã¯vllm/sglangã§ã®ã¿æ­£ã—ãæŽ¨è«–ã§ãã‚‹ã“ã¨ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚
* ShelterWã¯ã€gemma-2-27Bã‚’vLLMã§ç¾åœ¨ä½¿ç”¨ã§ãã‚‹ã‹ã©ã†ã‹ã‚’å°‹ã­ã¾ã—ãŸã€‚
* Somesh88ã¯ã€Kaggleã®gemma-2ã®é‡ã¿ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ãªã„ãŸã‚ã€Transformersã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã«ãªã‚‹å•é¡Œã‚’æèµ·ã—ã¾ã—ãŸã€‚
* Kishan Vavdaraã¯ã€è¨­å®šã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€é‡ã¿ã‚’Kaggleãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¨ã—ã¦ä½œæˆã™ã‚‹ã“ã¨ã§ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ãªã—ã§æŽ¨è«–ãƒŽãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã«è¿½åŠ ã§ãã‚‹è§£æ±ºç­–ã‚’ææ¡ˆã—ã¾ã—ãŸã€‚

**çµè«–:**

ã“ã®ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã¯ã€gemma-2-27Bã‚’vLLMã§åˆ©ç”¨ã™ã‚‹ã“ã¨ã®èª²é¡Œã¨ã€ãã®å•é¡Œã«å¯¾ã™ã‚‹æ½œåœ¨çš„ãªè§£æ±ºç­–ã«ã¤ã„ã¦è­°è«–ã—ã¦ã„ã¾ã™ã€‚vLLMã¯ã€gemma-2-27Bã®ã‚ˆã†ãªå¤§è¦æ¨¡è¨€èªžãƒ¢ãƒ‡ãƒ«ã‚’åŠ¹çŽ‡çš„ã«å®Ÿè¡Œã™ã‚‹ãŸã‚ã®æœ‰æœ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ãŒã€GPUã‚µãƒãƒ¼ãƒˆã®åˆ¶é™ã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¬ å¦‚ãªã©ã€å…‹æœã™ã¹ãèª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚


---
# vLLMã§gemma-2-27Bã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã‹ï¼Ÿ

**yechenzhi1** *2024å¹´7æœˆ23æ—¥ ç«æ›œæ—¥ 00:34:19 æ—¥æœ¬æ¨™æº–æ™‚* (1ç¥¨)

[@cdeotte](https://www.kaggle.com/cdeotte) ã®ç´ æ™´ã‚‰ã—ã„[ä»•äº‹](https://www.kaggle.com/competitions/lmsys-chatbot-arena/discussion/521294) ã«è§¦ç™ºã•ã‚Œã¦ã€gemma-2-27Bã‚’vLLMã§ä½¿ç”¨ã—ã‚ˆã†ã¨è©¦ã¿ã¦ã„ã¾ã™ã€‚ã¾ãšã€GPTQmodelã‚’ä½¿ã£ã¦4ãƒ“ãƒƒãƒˆã«é‡å­åŒ–ã—ã€æ¬¡ã«vLLM-0.5.2ã‚’ä½¿ã£ã¦æŽ¨è«–ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã—ã‹ã—ã€gemma-2ã®ãƒ­ã‚¸ãƒƒãƒˆä¸Šé™ã®ãŸã‚ã€FlashInferã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã—ã¦å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚FlashInferã¯ã€[compute capability >= 8.0](https://github.com/vllm-project/vllm/issues/6173#issuecomment-2214759644) ã®GPUã®ã¿ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã¨ã•ã‚Œã¦ãŠã‚Šã€T4ã¯7.5ã§ã™ã€‚ã¤ã¾ã‚Šã€gemma-2-27bã¯ã“ã®ã‚³ãƒ³ãƒšãƒ†ã‚£ã‚·ãƒ§ãƒ³ã§ã¯ä¸å¯èƒ½ãªã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
---
# ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ
> ## Yixiao Yuan
> 
> gemma-2ã‚’vLLMã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã¯ã§ããªã„ã¨æ€ã„ã¾ã™ãŒã€Hugging Faceã§å®Ÿè¡Œã§ãã¾ã™ã€‚vLLMã¯ã€PagedAttentionã®ãŠã‹ã’ã§ç”Ÿæˆã‚¿ã‚¹ã‚¯ã«é©ã—ã¦ã„ã¾ã™ãŒã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’1ã¤ã ã‘ç”Ÿæˆã™ã‚‹å ´åˆã‚„åˆ†é¡žãƒ˜ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ˆã“ã®ã‚ˆã†ãªå ´åˆã€KVã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ä¸è¦ã§ã™ï¼‰ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã¯ä¼¼ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚
> 
> 
> 
> > ## yechenzhi1ãƒˆãƒ”ãƒƒã‚¯ä½œæˆè€…
> > 
> > æ‚ªã„çŸ¥ã‚‰ã›ã§ã™ãŒã€ç¾åœ¨ã€[é‡å­åŒ–ã•ã‚ŒãŸgemma-2-27b](https://github.com/ModelCloud/GPTQModel/issues/140#issuecomment-2242221690) ã‚’æ­£ã—ãæŽ¨è«–ã§ãã‚‹ã®ã¯vllm/sglangã®ã¿ã®ã‚ˆã†ã§ã™ã€‚
> > 
> > 
> > 
> > ## yechenzhi1ãƒˆãƒ”ãƒƒã‚¯ä½œæˆè€…
> > 
> > ã—ã‹ã—ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ ãã‚Œã§ã‚‚è©¦ã—ã¦ã¿ã¾ã™ï¼
> > 
> > 
> > 
> > > ## beanpotato
> > > 
> > > gema-2-27bã‚’vLLMã§å®Ÿè¡Œã§ããŸã‹ã©ã†ã‹æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼ŸðŸ¥°
> > > 
> > > 
> > > 
> > > ## yechenzhi1ãƒˆãƒ”ãƒƒã‚¯ä½œæˆè€…
> > > 
> > > ã„ã„ãˆã€T4 GPUã¯FlashInferã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚æ•°æ—¥å¾Œã€gemma-2-27Bã®è©¦ã¿ã‚’ä¸­æ­¢ã—ã¾ã—ãŸã€‚
> > > 
> > > 
> > > 
---
> ## ShelterW
> 
> gemma-2-27Bã‚’vLLMã§ç¾åœ¨ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã‹ï¼Ÿ
> 
> 
> 
> > ## Somesh88
> > 
> > gemma 2ã‚’vllmã§è©¦ã—ã¦ã„ã¾ã™ãŒã€Kaggleã®é‡ã¿ã«ã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Transformersã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯æå‡ºã§ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã«å¯¾ã™ã‚‹å›žé¿ç­–ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
> > 
> > 
> > 
> > > ## Kishan Vavdara
> > > 
> > > è¨­å®šã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€é‡ã¿ãªã©ã®Kaggleãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã¦ã€æŽ¨è«–ãƒŽãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã«è¿½åŠ ã§ãã¾ã™ã€‚ãã†ã™ã‚Œã°ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ãªãä½¿ç”¨ã§ãã¾ã™ã€‚
> > > 
> > > 
> > > 
---

